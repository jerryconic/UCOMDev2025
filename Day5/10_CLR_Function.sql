EXEC sp_who

USE master;
IF EXISTS(SELECT * FROM sys.databases WHERE name = 'db01')
BEGIN
	ALTER DATABASE db01 SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
	DROP DATABASE db01;
END
GO

CREATE DATABASE [db01]
GO
USE db01;
GO


EXEC sp_configure;

EXEC sp_configure 'show advanced options', 1;

RECONFIGURE;


EXEC sp_configure 'clr enabled', 1
EXEC sp_configure 'clr strict security', 0

RECONFIGURE;

EXEC sp_configure;

----------------------------------------------------

USE [db01]
GO
CREATE ASSEMBLY [Database1]
AUTHORIZATION [dbo]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300AA751D680000000000000000E00022200B01300000060000000600000000000052250000002000000040000000000010002000000002000004000000000000000600000000000000008000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000002500004F00000000400000A802000000000000000000000000000000000000006000000C000000C82300001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000058050000002000000006000000020000000000000000000000000000200000602E72737263000000A8020000004000000004000000080000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000C0000000000000000000000000000400000420000000000000000000000000000000034250000000000004800000002000500642000006403000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002E7201000070730500000A2A1E02280600000A2A42534A4201000100000000000C00000076342E302E33303331390000000005006C00000020010000237E00008C0100005001000023537472696E677300000000DC0200001C00000023555300F8020000100000002347554944000000080300005C00000023426C6F620000000000000002000001471400000900000000FA01330016000001000000070000000200000002000000060000000400000001000000020000000000A70001000000000006005F00F00006007F00F00006003600DD000F001001000006004901B5000A004A00BC000A009D001F010000000018000000000001000100010010003401000015000100010050200000000096000B001E0001005C20000000008618D700060001000900D70001001100D70006001900D7000A003100D70006003900D70010002900D70006002000230054002E000B0023002E0013002C002E001B004B000480000000000000000000000000000000000100000004000000000000000000000015002D000000000004000000000000000000000015002100000000000000004461746162617365310053716C46756E6374696F6E31003C4D6F64756C653E0053797374656D2E44617461006D73636F726C69620044656275676761626C654174747269627574650053716C46756E6374696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053716C537472696E67004461746162617365312E646C6C0053797374656D004D6963726F736F66742E53716C5365727665722E536572766572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C54797065730055736572446566696E656446756E6374696F6E73004F626A656374000019480065006C006C006F00200077006F0072006C006400210000003419C78F0B06C74A91FF8931D9EE72E400042001010803200001052001011111042001010E08B77A5C561934E089040000111D0801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301080100020000000000040100000000000000000000AA751D6800000000020000001C010000E4230000E4050000525344538D1F43BBADB0BB43B2B1A0D4C8C5C24701000000433A5C53514C50726F6772616D5C4461746162617365315C4461746162617365315C6F626A5C52656C656173655C4461746162617365312E7064620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002825000000000000000000004225000000200000000000000000000000000000000000000000000034250000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000004C02000000000000000000004C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004AC010000010053007400720069006E006700460069006C00650049006E0066006F0000008801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000003C000E00010049006E007400650072006E0061006C004E0061006D00650000004400610074006100620061007300650031002E0064006C006C0000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000044000E0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000004400610074006100620061007300650031002E0064006C006C000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000543500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO

CREATE FUNCTION dbo.Hi()
RETURNS nvarchar(20)
EXTERNAL NAME Database1.UserDefinedFunctions.SqlFunction1;
GO

SELECT dbo.Hi();

DROP FUNCTION dbo.Hi;
DROP ASSEMBLY Database1;

GO
CREATE ASSEMBLY [Database1]
AUTHORIZATION [dbo]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103008D7A1D680000000000000000E00022200B013000000600000006000000000000E2250000002000000040000000000010002000000002000004000000000000000600000000000000008000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000902500004F00000000400000A802000000000000000000000000000000000000006000000C000000582400001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000E8050000002000000006000000020000000000000000000000000000200000602E72737263000000A8020000004000000004000000080000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000C00000000000000000000000000004000004200000000000000000000000000000000C425000000000000480000000200050088200000D003000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002E7201000070730500000A2A13300200150000000100001102280600000A03280600000A0A0658730700000A2A1E02280800000A2A00000042534A4201000100000000000C00000076342E302E33303331390000000005006C0000005C010000237E0000C80100007001000023537472696E677300000000380300001C0000002355530054030000100000002347554944000000640300006C00000023426C6F620000000000000002000001471502000900000000FA013300160000010000000800000002000000030000000200000008000000050000000100000001000000020000000000B00001000000000006006800030106008800030106003F00F0000F002301000006005C01BE000A005300CF000A00A60032010A00180032010000000021000000000001000100010010004701000015000100010050200000000096000B00280001005C20000000009600C5002D0001007D20000000008618EA0006000300000001003400000002003D000900EA0001001100EA0006001900EA000A003100EA0006003900EA0010004100630119004100EA0001002900EA0006002000230067002E000B0036002E0013003F002E001B005E004000230067001500048000000000000000000000000000000000010000000400000000000000000000001F003600000000000400000000000000000000001F002A00000000000000004461746162617365310053716C46756E6374696F6E310053716C496E743332003C4D6F64756C653E0053797374656D2E44617461006D73636F726C69620044656275676761626C654174747269627574650053716C46756E6374696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053716C537472696E67004461746162617365312E646C6C0053797374656D004164644E756D626572004D6963726F736F66742E53716C5365727665722E536572766572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C54797065730055736572446566696E656446756E6374696F6E73004F626A656374006F705F4578706C6963697400000019480065006C006C006F00200077006F0072006C0064002100000080BB9A097B2325459EAF65D9AAEB76E900042001010803200001052001011111042001010E0307010805000108112108B77A5C561934E089040000111D0800021121112111210801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010801000200000000000401000000000000008D7A1D6800000000020000001C0100007424000074060000525344534713C0573A1E6B47AAA0FED2BA2A324101000000433A5C53514C50726F6772616D5C4461746162617365315C4461746162617365315C6F626A5C52656C656173655C4461746162617365312E706462000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B82500000000000000000000D2250000002000000000000000000000000000000000000000000000C4250000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000004C02000000000000000000004C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004AC010000010053007400720069006E006700460069006C00650049006E0066006F0000008801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000003C000E00010049006E007400650072006E0061006C004E0061006D00650000004400610074006100620061007300650031002E0064006C006C0000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000044000E0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000004400610074006100620061007300650031002E0064006C006C000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000E43500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO


CREATE FUNCTION dbo.Hi()
RETURNS nvarchar(20)
EXTERNAL NAME Database1.UserDefinedFunctions.SqlFunction1;
GO
--Signature(函式簽章必須和C#中的型別一致)
ALTER DATABASE db01 SET TRUSTWORTHY ON;
GO

SELECT dbo.Hi();

SELECT dbo.AddNum(10, 20);

/*
Tools => Options

Query Results
	-> SQL Server
		-> Results to Text
			-> Maximum number of characters displayed in each column: 65536
*/

GO
ALTER DATABASE db01 SET TRUSTWORTHY ON;
GO

CREATE ASSEMBLY [ReadFile]
AUTHORIZATION [dbo]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300378D1D680000000000000000E00022200B013000000600000006000000000000D6250000002000000040000000000010002000000002000004000000000000000600000000000000008000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000842500004F00000000400000A802000000000000000000000000000000000000006000000C0000004C2400001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000DC050000002000000006000000020000000000000000000000000000200000602E72737263000000A8020000004000000004000000080000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000C00000000000000000000000000004000004200000000000000000000000000000000B82500000000000048000000020005008C200000C003000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001330020025000000010000110F00FE16070000016F0500000A730600000A256F0700000A0A6F0800000A06730900000A2A1E02280A00000A2A00000042534A4201000100000000000C00000076342E302E33303331390000000005006C00000054010000237E0000C00100008801000023537472696E6773000000004803000004000000235553004C0300001000000023475549440000005C0300006400000023426C6F620000000000000002000001471502000900000000FA01330016000001000000090000000200000002000000010000000A000000040000000100000001000000020000000000C50001000000000006007400250106009400250106004B0012010F004501000006007E01D2000A005F00F1000A00B20054010600D9000A000600E6000A0000000000010000000000010001000100100069010000150001000100502000000000960033002600010081200000000086180C0106000200000001003C0009000C01010011000C01060019000C010A0031000C0106002900BC00140041000C01180049002900140049004500060039000C01180029000C010600200023005E002E000B002D002E00130036002E001B0055001000048000000000000000000000000000000000330000000400000000000000000000001D002000000000000400000000000000000000001D001400000000000000003C4D6F64756C653E0053797374656D2E494F0053797374656D2E44617461006D73636F726C69620052656164546F456E64005265616446696C650066696C656E616D6500436C6F73650044656275676761626C654174747269627574650053716C46756E6374696F6E41747472696275746500436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053716C537472696E6700546F537472696E67005265616446696C652E646C6C0053797374656D0053747265616D5265616465720054657874526561646572004D6963726F736F66742E53716C5365727665722E536572766572002E63746F720053797374656D2E446961676E6F73746963730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300446562756767696E674D6F6465730053797374656D2E446174612E53716C54797065730055736572446566696E656446756E6374696F6E73004F626A6563740000000000000000145AB9DA77CC9147B5CCB5A489FBAA33000420010108032000010520010111110307010E0320000E042001010E08B77A5C561934E089060001111D111D0801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730108010002000000000004010000000000000000378D1D6800000000020000001C01000068240000680600005253445349D9E193187F7446A3F3520C7C60E86F01000000433A5C53514C50726F6772616D5C5265616446696C655C5265616446696C655C6F626A5C52656C656173655C5265616446696C652E706462000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000AC2500000000000000000000C6250000002000000000000000000000000000000000000000000000B8250000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500200010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000004C02000000000000000000004C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004AC010000010053007400720069006E006700460069006C00650049006E0066006F0000008801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000003A000D00010049006E007400650072006E0061006C004E0061006D00650000005200650061006400460069006C0065002E0064006C006C00000000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000042000D0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005200650061006400460069006C0065002E0064006C006C0000000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000D83500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = EXTERNAL_ACCESS

GO


CREATE FUNCTION dbo.ReadFile(@filename nvarchar(100))
RETURNS nvarchar(max)
EXTERNAL NAME ReadFile.UserDefinedFunctions.ReadFile;
GO

SELECT dbo.ReadFile(N'C:\Data\Day1\03_Collation.sql');